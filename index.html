<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="description" content="Гид по породам кошек - подберите идеальную породу для вашего дома. Поиск, категории, подробные описания и подбор породы по характеристикам." />
  <meta name="keywords" content="кошки, породы кошек, выбор кошки, мейн-кун, британская, сфинкс, бенгальская" />
  <meta name="theme-color" content="#2ea56a" />
  <title>Гид по породам кошек</title>
  
  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Preload критических изображений для ускорения загрузки -->
  <link rel="preload" as="image" href="https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/hero.png">
  <link rel="preload" as="image" href="https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/long-haired.png">
  <link rel="preload" as="image" href="https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/hairless.png">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap&subset=cyrillic" rel="stylesheet">
  
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Critical CSS inline for faster loading -->
  <style>
    :root{
      --bg:#0f1113;--surface:#171a1c;--muted:#9aa3ad;--text:#e9eef2;--primary:#2ea56a;--primary-700:#1f8b55;--border:#252a2e;
      --radius:14px;--radius-lg:18px;--gap-2:8px;--gap-3:12px;--gap-4:16px;--gap-5:20px;--gap-6:24px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Nunito,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text); background:linear-gradient(180deg,#0f1113 0%,#111416 100%);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit}
    .container{max-width:900px;margin:0 auto;padding:0 16px}
    .page{display:none;min-height:100dvh}
    .page.active{display:flex;flex-direction:column}
    header.site{padding:32px 0 8px;text-align:center}
    .title{font-size:32px;font-weight:800;margin:0 0 6px}
    .subtitle{margin:0 0 18px;color:var(--muted)}
    .hero-image-container{display:flex;justify-content:center;margin:24px 0}
    .hero-image{width:100%;max-width:400px;height:280px;object-fit:contain;border-radius:var(--radius-lg);background:transparent;pointer-events:none}
    .search-row{display:flex;gap:var(--gap-3);align-items:center;flex-wrap:wrap;justify-content:center}
    .search{flex:1;min-width:200px;max-width:300px;display:flex;background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .search input{
      width:100%;padding:12px 14px 12px 44px;background:transparent;border:0;color:var(--text);outline:none;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%239AA3AD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>');
      background-repeat:no-repeat;background-position:12px center;font-size:16px;min-height:44px;
    }
    .btn{display:inline-flex;align-items:center;justify-content:center;
      gap:10px;padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:var(--surface);
      color:var(--text);cursor:pointer;transition:.15s ease;white-space:nowrap;font-size:16px;min-height:44px;
    }
    .btn--primary{background:linear-gradient(135deg, #2ea56a 0%, #8b5cf6 100%);border-color:transparent}
    .btn:hover{transform:translateY(-1px)}
    .btn--primary:hover{background:linear-gradient(135deg, #1f8b55 0%, #7c3aed 100%);transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .grid{display:flex;flex-wrap:wrap;gap:var(--gap-6)}
    .card{flex:1 1 280px;max-width:422px;min-width:280px;width:100%;display:flex;flex-direction:column;gap:12px;
      background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:14px;transition:.15s ease;
      cursor:pointer;touch-action:manipulation;
    }
    .ph--black{background:rgb(23,26,28) !important}
    .card:hover{transform:translateY(-2px)}
    .card:active{transform:translateY(0)}
    .ph{height:200px;border-radius:12px;background:transparent;display:flex;align-items:center;justify-content:center;color:#a3aab3;overflow:visible;padding:8px}
    .ph img{width:100%;height:100%;object-fit:contain;border-radius:12px;padding:8px}
    .card h3{margin:0 0 6px;font-size:18px;font-weight:600}
    .muted{color:var(--muted);font-size:14px;line-height:1.4}
    .chip{align-self:flex-start;padding:6px 10px;border-radius:999px;border:1px solid #355; background:#1a2126; color:#86d3ff;font-size:12px}
    section{display:flex;flex-direction:column;gap:var(--gap-5);margin:22px 0}
    .section-title{font-size:20px;margin:0;font-weight:600}
    .footer{margin-top:auto;border-top:1px solid var(--border);padding:20px 0;color:var(--muted);font-size:14px}
    .topbar{display:flex;align-items:center;gap:10px;margin:10px 0;flex-wrap:wrap}
    .topbar .back{padding:10px 12px;border-radius:10px;background:var(--surface);border:1px solid var(--border);min-height:44px;color:var(--text)}
    .detail-hero{display:flex;gap:12px;flex-wrap:wrap}
    .hero-img{flex:1 1 320px;max-width:422px;height:260px;background:var(--surface);border:1px solid var(--border);border-radius:14px}
    .hero-info{flex:1 1 auto;display:flex;flex-direction:column;gap:6px;align-items:flex-start}
    .cols{display:flex;gap:var(--gap-6);flex-wrap:wrap}
    .box{flex:1 1 320px;background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px}
    .list{display:flex;flex-direction:column;gap:12px}
    .breeder{display:flex;flex-direction:column;gap:8px;align-items:flex-start}
    .link{color:#86d3ff;text-decoration:none;min-height:44px;display:inline-flex;align-items:center}
    .link:hover{text-decoration:underline}
    
    /* Стили для иконок в разделах */
    .section-icon {
      width: 20px;
      height: 20px;
      margin-right: 8px;
      display: inline-block;
      vertical-align: middle;
      fill: var(--primary);
    }
    
    .section-title-with-icon {
      display: flex;
      align-items: center;
      margin: 0 0 10px;
    }
    
    /* Стили для модального окна */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      max-width: 400px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
    }
    
    .modal-header h3 {
      margin: 0;
      font-size: 18px;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--muted);
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-close:hover {
      color: var(--text);
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-cat-info {
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--text);
    }
    
    .form-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      font-size: 16px;
      box-sizing: border-box;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .error-message {
      color: #ff6b6b;
      font-size: 14px;
      margin-top: 4px;
    }
    
    .form-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 20px;
    }
    
    .form-actions .btn {
      min-width: 100px;
    }
    
    /* Стили для кнопок бронирования */
    .booking-btn.booked {
      background: var(--muted) !important;
      border-color: var(--muted) !important;
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    .booking-btn.booked:hover {
      transform: none !important;
    }
    .quiz{display:flex;flex-direction:column;gap:16px}
    .q{display:flex;flex-direction:column;gap:10px;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px}
    .opts{display:flex;flex-wrap:wrap;gap:10px}
    .opt{padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#15181a;cursor:pointer;min-height:44px;display:flex;align-items:center;justify-content:center;text-align:center;transition:.15s ease}
    .opt input{display:none}
    .opt.active{background:#2ea56a;border-color:#2ea56a;color:#ffffff}
    .opt:hover{background:#1a1f22;border-color:#2c3238}
    .opt:active{transform:scale(0.98)}
    
    /* Mobile optimizations */
    @media (max-width:840px){
      .card{max-width:422px}
      .ph{height:180px;padding:6px}
      .title{font-size:28px}
      .hero-image{max-width:350px;height:240px;object-fit:contain}
      .search-row{flex-direction:column;align-items:center}
      .search{min-width:auto;max-width:300px;width:100%}
      .btn{width:100%;justify-content:center}
      .detail-hero{flex-direction:column;gap:8px}
      .hero-img{flex:none;width:100%;max-width:422px}
      .cols{flex-direction:column}
      .box{flex:none;width:100%}
      .breeder{flex-direction:column;align-items:flex-start;gap:8px}
      .opts{flex-direction:column}
      .opt{width:100%}
      .section-title{text-align:center}
      .grid{justify-content:center}
      
      /* Mobile compact category icons */
      .category-icons {
        gap: 8px;
        padding: 0 8px;
      }
      
      .category-icon {
        width: 48px;
        height: 48px;
        min-width: 44px;
        min-height: 44px;
      }
    }
    
    @media (max-width:480px){
      .container{padding:0 12px}
      header.site{padding:24px 0 8px}
      .title{font-size:24px}
      .hero-image{max-width:300px;height:200px;object-fit:contain}
      .card{padding:12px}
      .ph{height:160px;padding:4px}
      .btn{padding:14px 16px;font-size:16px}
      .search input{padding:12px 16px 12px 48px;font-size:16px;min-height:44px}
      .topbar{gap:8px}
      .topbar .back{padding:12px 14px}
      .section-title{text-align:center}
      .grid{justify-content:center}
    }
    
    /* Performance optimizations */
    .card,.btn,.opt{will-change:transform}
    .card:hover,.btn:hover,.opt:hover{will-change:auto}
    
    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      .card,.btn,.opt{transition:none}
      .card:hover,.btn:hover,.opt:hover{transform:none}
    }
    
    /* Compact category icons for search mode */
    .category-icons {
      display: none;
      flex-direction: row;
      gap: 12px;
      justify-content: center;
      margin: 8px 0 16px 0;
      padding: 0 16px;
    }
    
    .category-icon {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.25s ease-out;
      overflow: hidden;
    }
    
    .category-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 8px;
      padding: 4px;
      background: transparent;
    }
    
    .category-icon:hover {
      transform: translateY(-2px);
      border-color: var(--primary);
    }
    
    .category-icon:active {
      transform: scale(0.95);
    }
    
    /* Search active state */
    .search-active .category-icons {
      display: flex;
    }
    
    .search-active #cats-cats {
      display: none;
    }
    
    .search-active #search-results-section {
      display: block;
    }
    
    /* Center category title when in compact view and keep it visible */
    .search-active .section-title {
      text-align: center;
      display: block !important;
    }
    
    /* Search results section */
    #search-results-section {
      display: none;
    }
    
    /* Search results title styling */
    #search-results-title {
      font-size: 16px;
      color: var(--muted);
      margin-bottom: 24px;
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f5f6f8;
        --surface: #ffffff;
        --text: #0b0c0d;
        --muted: #6c727a;
        --border: #e1e5e9;
      }
      .ph{background:transparent;color:#6c727a}
      .hero-img{background:var(--surface);border:1px solid var(--border)}
    }
  </style>
</head>
<body>
  <main id="main" class="page active">
    <div class="container">
      <header class="site">
        <h1 class="title">Гид по породам кошек</h1>
        <p class="subtitle">Поможем найти идеальную породу для вашего дома</p>
        <div class="hero-image-container">
          <img id="hero-image" src="https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/hero.png" alt="Разнообразные породы кошек" class="hero-image">
        </div>
        <div class="search-row">
          <div class="search"><input id="search" placeholder="Поиск по породам..." /></div>
        </div>
        <button class="btn btn--primary" id="to-quiz-top" style="margin-top: 16px; width: 100%; max-width: 300px; margin-left: auto; margin-right: auto; display: block;">Подобрать породу</button>
      </header>

      <section>
        <h2 class="section-title">Категории пород</h2>
        
        <!-- Compact category icons (shown during search) -->
        <div class="category-icons">
          <div class="category-icon" data-category="longhair">
            <img src="https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/long-haired.png" alt="Длинношерстные породы">
          </div>
          <div class="category-icon" data-category="shorthair">
            <img src="https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/short-haired.png" alt="Короткошерстные породы">
          </div>
          <div class="category-icon" data-category="hairless">
            <img src="https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/hairless.png" alt="Бесшерстные породы">
          </div>
          <div class="category-icon" data-category="exotic">
            <img src="https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/exotic.png" alt="Экзотические породы">
          </div>
        </div>
        
        <!-- Full category cards (shown by default) -->
        <div id="cats-cats" class="grid"></div>
      </section>
      
      <!-- Search results section -->
      <section id="search-results-section">
        <h2 class="section-title" id="search-results-title">Результаты поиска</h2>
        <div id="search-grid" class="grid"></div>
      </section>
      
      <section>
        <h2 class="section-title">Кошки из базы данных</h2>
        <div id="cat-list" class="cat-list-container"></div>
      </section>
      
      
      <footer class="footer">
        <div class="container" style="display:flex;gap:16px;flex-wrap:wrap;justify-content:space-between">
          <div>Контакты: hello@cats.example</div>
          <div style="display:flex;gap:12px">
            <a class="link" href="#" aria-label="Instagram">Instagram</a>
            <a class="link" href="#" aria-label="Telegram">Telegram</a>
            <a class="link" href="#" aria-label="VKontakte">VK</a>
          </div>
        </div>
      </footer>
    </div>
  </main>

  <section id="category" class="page">
    <div class="container">
      <div class="topbar">
        <button class="back" id="back-main" aria-label="Назад к главной">← Назад</button>
        <h2 id="cat-title" class="title" style="margin:0"></h2>
      </div>
      <div id="cat-grid" class="grid"></div>
    </div>
  </section>

  <section id="detail" class="page">
    <div class="container">
      <div class="topbar">
        <button class="back" id="back-category" aria-label="Назад к категории">← Категория</button>
        <h2 id="detail-title" class="title" style="margin:0"></h2>
      </div>

      <div class="detail-hero">
        <div class="hero-img" id="detail-image"></div>
        <div class="hero-info">
          <h3 id="detail-name" style="margin:0"></h3>
          <div class="muted">Кем выведена: <span id="detail-origin"></span></div>
          <div class="chip" id="detail-suitable"></div>
        </div>
      </div>

      <div class="cols" style="margin-top:18px">
        <div class="box">
          <h4 class="section-title-with-icon">
            <svg class="section-icon" viewBox="0 0 24 24">
              <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H19C20.11 23 21 22.11 21 21V9M19 9H14V4H5V21H19V9Z"/>
            </svg>
            Характер
          </h4>
          <div id="detail-character" class="muted"></div>
        </div>
        <div class="box">
          <h4 class="section-title-with-icon">
            <svg class="section-icon" viewBox="0 0 24 24">
              <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
            </svg>
            Особенности ухода
          </h4>
          <div id="detail-care" class="muted"></div>
        </div>
        <div class="box">
          <h4 class="section-title-with-icon">
            <svg class="section-icon" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12S6.48 22 12 22 22 17.52 22 12 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z"/>
            </svg>
            Кому подходит
          </h4>
          <div id="detail-suitable-detail" class="muted"></div>
        </div>
      </div>

      <div class="box" style="margin-top:18px">
        <h4 class="section-title-with-icon">
          <svg class="section-icon" viewBox="0 0 24 24">
            <path d="M12 2L2 7L12 12L22 7L12 2ZM2 17L12 22L22 17M2 12L12 17L22 12"/>
          </svg>
          Питомники в России
        </h4>
        <div id="detail-breeders" class="list"></div>
      </div>
    </div>
  </section>

  <section id="quiz" class="page">
    <div class="container">
      <div class="topbar">
        <button class="back" id="back-main-from-quiz" aria-label="Назад к главной">← Назад</button>
        <h2 class="title" style="margin:0">Подбор породы</h2>
      </div>
      <div class="quiz" id="quiz-wrap"></div>
      <div style="display:flex;gap:12px;margin-top:8px;flex-wrap:wrap">
        <button class="btn" id="reset-quiz">Сбросить</button>
        <button class="btn btn--primary" id="show-results">Показать результаты</button>
      </div>
      <section style="margin-top:20px">
        <h3 class="section-title">Результаты</h3>
        <div id="results-grid" class="grid"></div>
      </section>
    </div>
  </section>

  <!-- Модальное окно для бронирования -->
  <div id="booking-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">Забронировать кошку</h3>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p id="modal-cat-info" class="modal-cat-info"></p>
        <form id="booking-form">
          <div class="form-group">
            <label for="booking-email">Email для связи:</label>
            <input type="email" id="booking-email" name="email" required placeholder="your@email.com">
            <div id="email-error" class="error-message" style="display: none;"></div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn" id="modal-cancel">Отмена</button>
            <button type="submit" class="btn btn--primary" id="modal-submit">Забронировать</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Optimized JavaScript with performance improvements
    const appData = {
      categories: {
        longhair: { name: "Длинношерстные породы" },
        shorthair: { name: "Короткошерстные породы" },
        hairless: { name: "Бесшерстные породы" },
        exotic: { name: "Экзотические и редкие породы" }
      },
      breeds: [
        // Длинношерстные породы
        {
          id:"maine_coon", category:"longhair", name:"Мейн-кун",
          short:"Крупная дружелюбная порода с рысьими ушами.",
          origin:"США, штат Мэн",
          suitable:"Для активных семей с детьми",
          character:"Дружелюбные, общительные, игривые, хорошо ладят с детьми.",
          care:"Расчесывать 2–3 раза в неделю, простор для активности.",
          suitableDetail:"Идеальны для семей, любящих активное общение с питомцем.",
          image:"https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/main-kun.png",
          breeders:[
            {name:"Мейн-кун клуб России", ig:"@mainecoon_russia", website:"https://mainecoon-russia.ru"},
            {name:"Северные гиганты", ig:"@northern_giants_cattery"},
            {name:"Русские гиганты", ig:"@russian_giants", website:"https://russian-giants.ru"}
          ],
          traits:{experience:"medium", space:"high", care:"medium", activity:"medium", children:"high", special_care:"medium", exotic:"low"}
        },
        {
          id:"siberian", category:"longhair", name:"Сибирская кошка",
          short:"Пушистая русская красавица с гипоаллергенной шерстью.",
          origin:"Россия, Сибирь",
          suitable:"Для семей с аллергией",
          character:"Умные, преданные, игривые, хорошо ладят с детьми и животными.",
          care:"Расчесывать 2–3 раза в неделю, особенно в период линьки.",
          suitableDetail:"Отлично подходят для семей с детьми и другими животными.",
          image:"https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/siberian.png",
          breeders:[
            {name:"Сибирский клуб", ig:"@siberian_cat_club"},
            {name:"Морозные красавицы", ig:"@frosty_siberians"},
            {name:"Сибирские красавицы", ig:"@siberian_beauties", website:"https://siberian-beauties.ru"}
          ],
          traits:{experience:"medium", space:"medium", care:"medium", activity:"medium", children:"high", special_care:"low", exotic:"low"}
        },
        {
          id:"persian", category:"longhair", name:"Персидская кошка",
          short:"Роскошная длинношерстная порода с плоской мордочкой.",
          origin:"Персия (Иран)",
          suitable:"Для спокойных домов",
          character:"Спокойные, ласковые, тихие, любят комфорт и покой.",
          care:"Ежедневное расчесывание, уход за глазами и носом.",
          suitableDetail:"Идеальны для спокойных домов без маленьких детей.",
          image:"https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/pers.png",
          breeders:[
            {name:"Персидский клуб", ig:"@persian_cat_club"},
            {name:"Роскошные персы", ig:"@luxury_persians"}
          ],
          traits:{experience:"medium", space:"low", care:"high", activity:"low", children:"low", special_care:"high", exotic:"low"}
        },
        
        // Короткошерстные породы
        {
          id:"british", category:"shorthair", name:"Британская короткошерстная",
          short:"Спокойная плюшевая классика с круглыми глазами.",
          origin:"Великобритания", 
          suitable:"Для занятых людей",
          character:"Сдержанные, преданные, терпеливые, независимые.",
          care:"Простой уход: вычесывание 1–2 раза в неделю.",
          suitableDetail:"Подходит для небольших квартир и размеренного ритма.",
          image:"https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/british.png",
          breeders:[
            {name:"Британский клуб", ig:"@british_cat_club"},
            {name:"Королевские британцы", ig:"@royal_british", website:"https://royal-british.ru"}
          ],
          traits:{experience:"low", space:"low", care:"low", activity:"low", children:"medium", special_care:"low", exotic:"low"}
        },
        {
          id:"russian_blue", category:"shorthair", name:"Русская голубая",
          short:"Элегантная кошка с серебристо-голубой шерстью.",
          origin:"Россия, Архангельск",
          suitable:"Для тихих домов",
          character:"Спокойные, умные, преданные, немного застенчивые.",
          care:"Минимальный уход, шерсть не линяет сильно.",
          suitableDetail:"Отлично подходят для квартир и тихих домов.",
          image:"https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/russian_blue.png",
          breeders:[
            {name:"Русская голубая клуб", ig:"@russian_blue_club"},
            {name:"Северные голубки", ig:"@northern_blues_cattery"}
          ],
          traits:{experience:"low", space:"low", care:"low", activity:"low", children:"medium", special_care:"low", exotic:"low"}
        },
        {
          id:"abyssinian", category:"shorthair", name:"Абиссинская кошка",
          short:"Активная и любознательная кошка с тикированной шерстью.",
          origin:"Эфиопия (Абиссиния)",
          suitable:"Для активных семей",
          character:"Очень активные, любознательные, игривые, умные.",
          care:"Минимальный уход, короткая шерсть.",
          suitableDetail:"Нуждаются в активности и внимании, не подходят для ленивых хозяев.",
          image:"https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/abissin.png",
          breeders:[
            {name:"Абиссинский клуб", ig:"@abyssinian_cat_club"},
            {name:"Эфиопские красавицы", ig:"@ethiopian_beauties_cattery"}
          ],
          traits:{experience:"medium", space:"medium", care:"low", activity:"high", children:"high", special_care:"low", exotic:"medium"}
        },
        
        // Бесшерстные породы
        {
          id:"sphynx", category:"hairless", name:"Канадский сфинкс",
          short:"Тёплая кожа и экстравертный характер без шерсти.",
          origin:"Канада", 
          suitable:"Для людей с аллергией",
          character:"Очень общительные и ласковые, любят внимание.",
          care:"Уход за кожей, контроль температуры, регулярные ванны.",
          suitableDetail:"Нуждаются в тепле и внимании, дружелюбны к детям.",
          image:"https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/sfinks.png",
          breeders:[
            {name:"Сфинкс клуб", ig:"@sphynx_cat_club"},
            {name:"Лунные кошки", ig:"@moon_sphynx", website:"https://moon-sphynx.ru"}
          ],
          traits:{experience:"high", space:"medium", care:"high", activity:"medium", children:"medium", special_care:"high", exotic:"high"}
        },
        
        // Экзотические породы
        {
          id:"bengal", category:"exotic", name:"Бенгальская кошка",
          short:"Домашний леопард — активная и умная с диким окрасом.",
          origin:"США", 
          suitable:"Для опытных владельцев",
          character:"Очень активны и любознательны, нуждаются в стимуляции.",
          care:"Много активности, короткая шерсть, игровые комплексы.",
          suitableDetail:"Лучше в просторном доме, необходима стимуляция.",
          image:"https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/bengal.png",
          breeders:[{name:"Бенгальский клуб", ig:"@bengal_cat_club"}],
          traits:{experience:"high", space:"high", care:"low", activity:"high", children:"low", special_care:"medium", exotic:"high"}
        },
        {
          id:"toyger", category:"exotic", name:"Тойгер",
          short:"Миниатюрный тигр с полосатым окрасом.",
          origin:"США",
          suitable:"Для любителей экзотики",
          character:"Активные, игривые, дружелюбные, хорошо ладят с детьми.",
          care:"Стандартный уход, много игр и активности.",
          suitableDetail:"Отлично подходят для семей с детьми, любят игры.",
          image:"https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/toiger.png",
          breeders:[
            {name:"Тойгер клуб", ig:"@toyger_cat_club"},
            {name:"Мини-тигры", ig:"@mini_tigers_cattery"}
          ],
          traits:{experience:"medium", space:"medium", care:"low", activity:"high", children:"high", special_care:"low", exotic:"high"}
        }
      ],
      questions:[
        {id:"experience", q:"Ваш опыт содержания кошек?", opts:[
          {v:"low",t:"Новичок"},{v:"medium",t:"Есть опыт"},{v:"high",t:"Эксперт"}
        ]},
        {id:"space", q:"Размер жилья?", opts:[
          {v:"low",t:"Малая квартира"},{v:"medium",t:"Большая квартира"},{v:"high",t:"Дом"}
        ]},
        {id:"care", q:"Время на уход?", opts:[
          {v:"low",t:"Минимум"},{v:"medium",t:"Средне"},{v:"high",t:"Много"}
        ]},
        {id:"activity", q:"Уровень активности?", opts:[
          {v:"low",t:"Спокойная"},{v:"medium",t:"Умеренная"},{v:"high",t:"Очень активная"}
        ]},
        {id:"children", q:"Дети в семье?", opts:[
          {v:"low",t:"Нет"},{v:"medium",t:"Дошкольники"},{v:"high",t:"Школьники/подростки"}
        ]},
        {id:"special_care", q:"Готовы к особому уходу?", opts:[
          {v:"low",t:"Нет"},{v:"medium",t:"Немного"},{v:"high",t:"Готов к сложному уходу"}
        ]},
        {id:"exotic", q:"Нужна ли необычность?", opts:[
          {v:"low",t:"Обычная"},{v:"medium",t:"Немного необычная"},{v:"high",t:"Очень экзотическая"}
        ]}
      ]
    };

    // State
    let currentCategory=null, quizAnswers={}, isSearchActive=false, cameFromSearch=false, cameFromQuiz=false;

    // DOM Elements - cached for performance
    const pages = {main: byId("main"), category: byId("category"), detail: byId("detail"), quiz: byId("quiz")};
    const searchInput = byId("search");
    const searchGrid = byId("search-grid");
    const catsCats = byId("cats-cats");
    const catTitle = byId("cat-title");
    const catGrid = byId("cat-grid");
    const detailTitle = byId("detail-title");
    const detailImage = byId("detail-image");
    const detailName = byId("detail-name");
    const detailOrigin = byId("detail-origin");
    const detailSuitable = byId("detail-suitable");
    const detailChar = byId("detail-character");
    const detailCare = byId("detail-care");
    const detailSuitDet = byId("detail-suitable-detail");
    const detailBreeders = byId("detail-breeders");
    const quizWrap = byId("quiz-wrap");
    const resultsGrid = byId("results-grid");

    // Helpers
    function byId(id){return document.getElementById(id)}
    function show(page){
      Object.values(pages).forEach(p=>p.classList.remove("active"));
      pages[page].classList.add("active");
      window.scrollTo({top:0,behavior:"smooth"});
    }
    const allBreeds = () => appData.breeds;

    // Debounced search for better performance
    let searchTimeout;
    function debounce(func, wait) {
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(searchTimeout);
          func(...args);
        };
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(later, wait);
      };
    }

    // Render categories
    function renderMainCategories(){
      if (!catsCats) return;
      catsCats.innerHTML = "";
      const cats = [
        {id:"longhair", title:appData.categories.longhair.name},
        {id:"shorthair", title:appData.categories.shorthair.name},
        {id:"hairless", title:appData.categories.hairless.name},
        {id:"exotic", title:appData.categories.exotic.name}
      ];
      cats.forEach(cat=>{
        const el = card({
          title:cat.title,
          subtitle:"Нажмите, чтобы открыть",
          onClick:()=>openCategory(cat.id),
          categoryId: cat.id
        });
        catsCats.appendChild(el);
      });
    }

    // Generic card with accessibility improvements
    function card({title, subtitle, onClick, chip, image, categoryId}){
      const el=document.createElement("article"); 
      el.className="card"; 
      el.tabIndex=0;
      el.setAttribute('role', 'button');
      el.setAttribute('aria-label', `${title}. ${subtitle}`);
      
      const ph=document.createElement("div"); 
      ph.className="ph"; 
      
      // Проверяем, есть ли изображение для категории в глобальной переменной
      let imageUrl = image;
      if (!imageUrl && categoryId && window.categoryImages && window.categoryImages[categoryId]) {
        imageUrl = window.categoryImages[categoryId];
      }
      
      if (imageUrl) {
        const img = document.createElement("img");
        img.src = imageUrl;
        img.alt = title;
        img.style.width = "100%";
        img.style.height = "100%";
        img.style.objectFit = "contain";
        img.style.borderRadius = "12px";
        img.style.maxWidth = "100%";
        img.style.maxHeight = "100%";
        img.style.padding = "8px";
        img.style.background = "transparent";
        // Обработка ошибки загрузки изображения
        img.onerror = function() {
          ph.textContent = "Фото";
          ph.setAttribute('aria-hidden', 'true');
        };
        ph.appendChild(img);
      } else {
        ph.textContent="Фото";
        ph.setAttribute('aria-hidden', 'true');
      }
      
      const h3=document.createElement("h3"); 
      h3.textContent=title;
      
      const p=document.createElement("div"); 
      p.className="muted"; 
      p.textContent=subtitle||"";
      
      el.appendChild(ph); 
      el.appendChild(h3); 
      
      if(chip){
        const c=document.createElement("div"); 
        c.className="chip"; 
        c.textContent=chip; 
        el.appendChild(c);
      } 
      
      el.appendChild(p);
      
      // Event listeners with passive option for better performance
      el.addEventListener("click",onClick, {passive: true}); 
      el.addEventListener("keypress",e=>{if(e.key==="Enter"||e.key===" ") onClick()}, {passive: true});
      
      return el;
    }

    // Search state management
    function activateSearchMode() {
      isSearchActive = true;
      pages.main.classList.add('search-active');
    }
    
    function deactivateSearchMode() {
      isSearchActive = false;
      pages.main.classList.remove('search-active');
      searchInput.value = '';
      if (searchGrid) searchGrid.innerHTML = '';
      const searchResultsTitle = byId('search-results-title');
      if (searchResultsTitle) searchResultsTitle.textContent = 'Результаты поиска';
    }

    // Optimized search with debouncing
    const debouncedSearch = debounce((query) => {
      if (query.trim()) {
        activateSearchMode();
        const results = allBreeds().filter(b=>
          b.name.toLowerCase().includes(query)||b.short.toLowerCase().includes(query)
        );
        renderBreedCards(results, searchGrid, true);
        
        // Update search results title
        const searchResultsTitle = byId('search-results-title');
        if (searchResultsTitle) {
          searchResultsTitle.textContent = `Результаты поиска (${results.length})`;
        }
      } else {
        deactivateSearchMode();
      }
    }, 300);

    // Search event listeners
    searchInput.addEventListener("input", (e)=>{
      debouncedSearch(e.target.value.trim().toLowerCase());
    });
    
    searchInput.addEventListener("focus", () => {
      if (searchInput.value.trim()) {
        activateSearchMode();
      }
    });
    
    searchInput.addEventListener("blur", () => {
      if (!searchInput.value.trim()) {
        deactivateSearchMode();
      }
    });

    // Category
    function openCategory(id){
      currentCategory=id;
      cameFromSearch = false; // Reset flag when opening category normally
      cameFromQuiz = false; // Reset flag when opening category normally
      catTitle.textContent = appData.categories[id].name;
      const items = allBreeds().filter(b=>b.category===id);
      catGrid.innerHTML=""; 
      renderBreedCards(items, catGrid);
      show("category");
    }

    // Breed cards
    function renderBreedCards(list, target, compact=false){
      if (!target) return;
      target.innerHTML="";
      
      // Use DocumentFragment for better performance
      const fragment = document.createDocumentFragment();
      
      list.forEach(b=>{
        const el = card({
          title:b.name,
          subtitle:b.short,
          chip:b.suitable,
          image:b.image,
          onClick:()=>openBreed(b)
        });
        if(compact){
          const ph = el.querySelector(".ph");
          if (ph) ph.style.height="140px";
        }
        
        // Добавляем кнопку бронирования
        if (window.SupabaseCats && window.SupabaseCats.addBookingButtonToCard) {
          window.SupabaseCats.addBookingButtonToCard(el, b);
        }
        
        fragment.appendChild(el);
      });
      
      target.appendChild(fragment);
    }

    // Detail
    function openBreed(b){
      // Clear search if we're coming from search results
      if (isSearchActive) {
        cameFromSearch = true;
        cameFromQuiz = false;
        deactivateSearchMode();
      } else {
        cameFromSearch = false;
        // Check if we're in quiz page to determine if coming from quiz
        cameFromQuiz = pages.quiz.classList.contains('active');
      }
      
      detailTitle.textContent = b.name;
      detailName.textContent = b.name;
      detailOrigin.textContent = b.origin;
      detailSuitable.textContent = b.suitable;
      detailChar.textContent = b.character;
      detailCare.textContent = b.care;
      detailSuitDet.textContent = b.suitableDetail;
      
      // Update detail image
      if (detailImage) {
        detailImage.innerHTML = "";
        if (b.image) {
          const img = document.createElement("img");
          img.src = b.image;
          img.alt = b.name;
          img.style.width = "100%";
          img.style.height = "100%";
          img.style.objectFit = "contain";
          img.style.borderRadius = "14px";
          img.style.maxWidth = "100%";
          img.style.maxHeight = "100%";
          img.style.background = "transparent";
          // Обработка ошибки загрузки изображения
          img.onerror = function() {
            detailImage.textContent = "Фото";
          };
          detailImage.appendChild(img);
        } else {
          detailImage.textContent = "Фото";
        }
      }
      
      detailBreeders.innerHTML = b.breeders.map(x=>{
        const links = [];
        
        // Добавляем Instagram ссылку
        if (x.ig) {
          links.push(`<a class="link" target="_blank" href="https://instagram.com/${x.ig.replace('@','')}" rel="noopener noreferrer">📷 ${x.ig}</a>`);
        }
        
        // Добавляем ссылку на сайт
        if (x.website) {
          links.push(`<a class="link" target="_blank" href="${x.website}" rel="noopener noreferrer">🌐 Сайт</a>`);
        }
        
        return `<div class="breeder">
          <span>${x.name}</span>
          <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 4px;">
            ${links.join('')}
          </div>
        </div>`;
      }).join("");
      
      // Добавляем кнопку бронирования в детальный просмотр (только если её еще нет)
      const breedersBox = detailBreeders.closest('.box');
      if (breedersBox) {
        // Проверяем, есть ли уже кнопка бронирования
        let detailBookingContainer = breedersBox.querySelector('.detail-booking-container');
        
        if (!detailBookingContainer) {
          // Создаем контейнер для кнопки только если его нет
          detailBookingContainer = document.createElement('div');
          detailBookingContainer.className = 'detail-booking-container';
          detailBookingContainer.style.cssText = 'margin-top: 20px; text-align: center;';
          
          const detailBookingBtn = document.createElement('button');
          detailBookingBtn.id = 'detail-booking-btn';
          detailBookingBtn.className = 'btn btn--primary booking-btn';
          detailBookingBtn.textContent = 'Выбрать';
          detailBookingBtn.style.cssText = 'width: 100%; max-width: 300px;';
          
          detailBookingBtn.addEventListener('click', () => {
            if (window.SupabaseCats && window.SupabaseCats.showBookingModal) {
              window.SupabaseCats.showBookingModal(b);
            }
          });
          
          detailBookingContainer.appendChild(detailBookingBtn);
          breedersBox.appendChild(detailBookingContainer);
        }
        
        // Обновляем атрибуты кнопки для текущей кошки
        const detailBookingBtn = detailBookingContainer.querySelector('#detail-booking-btn');
        if (detailBookingBtn) {
          detailBookingBtn.setAttribute('data-cat-id', b.id);
          
          // Обновляем состояние кнопки
          const email = window.SupabaseCats ? window.SupabaseCats.getCurrentUserEmail() : '';
          if (email && window.SupabaseCats && window.SupabaseCats.isCatBookedByEmail) {
            if (window.SupabaseCats.isCatBookedByEmail(b.id, email)) {
              detailBookingBtn.textContent = 'Забронировано';
              detailBookingBtn.disabled = true;
              detailBookingBtn.classList.add('booked');
            } else {
              detailBookingBtn.textContent = 'Выбрать';
              detailBookingBtn.disabled = false;
              detailBookingBtn.classList.remove('booked');
            }
          }
        }
      }
      
      show("detail");
    }

    // Quiz
    function renderQuiz(){
      if (!quizWrap) return;
      quizWrap.innerHTML="";
      quizAnswers={};
      
      appData.questions.forEach(q=>{
        const container=document.createElement("div"); 
        container.className="q";
        
        const h=document.createElement("div"); 
        h.textContent=q.q; 
        container.appendChild(h);
        
        const opts=document.createElement("div"); 
        opts.className="opts";
        
        q.opts.forEach(o=>{
          const lbl=document.createElement("label"); 
          lbl.className="opt"; 
          lbl.textContent=o.t;
          lbl.setAttribute('role', 'button');
          lbl.setAttribute('tabindex', '0');
          
          lbl.addEventListener("click",()=>{
            quizAnswers[q.id]=o.v; 
            [...opts.children].forEach(x=>x.classList.remove('active')); 
            lbl.classList.add('active');
          }, {passive: true});
          
          lbl.addEventListener("keypress", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              lbl.click();
            }
          }, {passive: true});
          
          opts.appendChild(lbl);
        });
        
        container.appendChild(opts);
        quizWrap.appendChild(container);
      });
    }

    function scoreMatch(breed){
      const u=quizAnswers; 
      let score=0, max=0;
      const weight = 1;
      Object.keys(breed.traits).forEach(k=>{
        if(!u[k]) return;
        max+=3*weight;
        if(u[k]===breed.traits[k]) score+=3*weight;
        else if(compatible(u[k],breed.traits[k])) score+=2*weight;
        else if(acceptable(u[k],breed.traits[k])) score+=1*weight;
      });
      return max? Math.round(score/max*100):0;
    }
    
    function compatible(u,b){
      const m={low:['medium'],medium:['low','high'],high:['medium']};
      return (m[u]||[]).includes(b);
    }
    
    function acceptable(){return false}

    function resultsFromQuiz(){
      // Очищаем результаты перед показом новых
      resultsGrid.innerHTML = "";
      
      console.log('Ответы квиза:', quizAnswers);
      
      const rated = allBreeds()
        .map(b=>({breed:b, pct:scoreMatch(b)}))
        .filter(x=>x.pct>0)
        .sort((a,b)=>b.pct-a.pct)
        .slice(0,3);
        
      console.log('Результаты квиза:', rated);
        
      if (rated.length > 0) {
        // Use the same renderBreedCards function as search results
        const breeds = rated.map(x => x.breed);
        renderBreedCards(breeds, resultsGrid, true);
      } else {
        resultsGrid.innerHTML = `<div class="muted">Нет совпадений — поменяйте ответы</div>`;
      }
    }
    
    window.openBreedFromResults = (id)=>openBreed(allBreeds().find(b=>b.id===id));

    // Navigation with passive event listeners
    byId("back-main").onclick=()=>show("main");
    byId("back-category").onclick=()=>{
      if (cameFromSearch) {
        show("main");
        cameFromSearch = false;
      } else if (cameFromQuiz) {
        show("main");
        cameFromQuiz = false;
      } else {
        show("category");
      }
    };
    byId("to-quiz-top").onclick=()=>{renderQuiz(); show("quiz")};
    byId("back-main-from-quiz").onclick=()=>show("main");
    byId("show-results").onclick=resultsFromQuiz;
    byId("reset-quiz").onclick=()=>{
      renderQuiz();
      // Очищаем результаты при сбросе
      if (resultsGrid) {
        resultsGrid.innerHTML = "";
      }
    };
    
    // Compact category icon event listeners
    document.addEventListener('DOMContentLoaded', function() {
      const categoryIcons = document.querySelectorAll('.category-icon');
      categoryIcons.forEach(icon => {
        icon.addEventListener('click', function() {
          const categoryId = this.getAttribute('data-category');
          if (categoryId) {
            // Clear search and deactivate search mode
            deactivateSearchMode();
            // Navigate to the selected category
            openCategory(categoryId);
          }
        });
      });
    });

    // Initialize with error handling
    function init() {
      try {
        renderMainCategories();
        // Скрываем секцию "Кошки из базы данных" по умолчанию
        const catListElement = document.getElementById('cat-list');
        const catSection = catListElement ? catListElement.closest('section') : null;
        if (catSection) {
          catSection.style.display = 'none';
        }
        
        // Устанавливаем изображение для длинношерстных пород через небольшую задержку
        setTimeout(() => {
          window.forceSetLonghairImageDirect();
          window.forceSetShorthairImageDirect();
          window.forceSetHairlessImageDirect();
          window.forceSetExoticImageDirect();
          ensureEqualCardSizes();
        }, 500);
        
        console.log('Application initialized successfully');
      } catch (error) {
        console.error('Error initializing application:', error);
      }
    }
    
    // Функция для обновления карточек категорий после загрузки изображений
    function updateCategoryCardsWithImages() {
      console.log('Обновляем карточки категорий...');
      console.log('window.categoryImages:', window.categoryImages);
      
      if (!window.categoryImages) {
        console.log('Нет изображений категорий');
        return;
      }
      
      const catsCatsElement = document.getElementById('cats-cats');
      if (!catsCatsElement) {
        console.log('Элемент cats-cats не найден');
        return;
      }
      
      const categoryCards = catsCatsElement.querySelectorAll('.card');
      console.log('Найдено карточек категорий:', categoryCards.length);
      
      categoryCards.forEach((card, index) => {
        const imageContainer = card.querySelector('.ph');
        if (imageContainer) {
          console.log(`Карточка ${index}:`, imageContainer.textContent);
          
          if (imageContainer.textContent === 'Фото') {
            // Получаем ID категории из заголовка
            const title = card.querySelector('h3').textContent;
            let categoryId = '';
            
            if (title.includes('Длинношерстные')) categoryId = 'longhair';
            else if (title.includes('Короткошерстные')) categoryId = 'shorthair';
            else if (title.includes('Бесшерстные')) categoryId = 'hairless';
            else if (title.includes('Экзотические')) categoryId = 'exotic';
            
            console.log(`Категория для "${title}": ${categoryId}`);
            
            if (categoryId && window.categoryImages[categoryId]) {
              console.log(`Загружаем изображение для ${categoryId}:`, window.categoryImages[categoryId]);
              
              // Очищаем контейнер
              imageContainer.innerHTML = '';
              
              // Создаем изображение
              const img = document.createElement('img');
              img.src = window.categoryImages[categoryId];
              img.alt = title;
              img.style.cssText = `
                width: 100%;
                height: 100%;
        object-fit: contain;
        border-radius: 12px;
        background: transparent;
        padding: 8px;
              `;
              
              // Обработка ошибки загрузки изображения
              img.onerror = function() {
                console.log('Ошибка загрузки изображения для', categoryId);
                imageContainer.textContent = "Фото";
                imageContainer.setAttribute('aria-hidden', 'true');
              };
              
              // Обработка успешной загрузки
              img.onload = function() {
                console.log('Изображение успешно загружено для', categoryId);
                imageContainer.removeAttribute('aria-hidden');
              };
              
              imageContainer.appendChild(img);
            } else {
              console.log(`Нет изображения для категории ${categoryId}`);
            }
          }
        }
      });
    }

    // Функция для принудительного обновления карточек категорий (для тестирования)
    window.forceUpdateCategoryImages = function() {
      console.log('Принудительное обновление изображений категорий...');
      updateCategoryCardsWithImages();
    };
    
    // Функция для установки всех изображений категорий
    window.setAllCategoryImages = function() {
      console.log('Устанавливаем изображения для всех категорий...');
      
      const categoryImages = {
        longhair: 'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/long-haired.png',
        shorthair: 'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/short-haired.png',
        hairless: 'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/hairless.png',
        exotic: 'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/exotic.png'
      };
      
      // Устанавливаем глобальную переменную
      window.categoryImages = categoryImages;
      
      // Обновляем карточки
      updateCategoryCardsWithImages();
      
      console.log('Все изображения категорий установлены:', categoryImages);
    };
    
    // Кэш для изображений
    const imageCache = new Map();
    
    // Функция предзагрузки изображений
    function preloadImages() {
      const imageUrls = [
        'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/hero.png',
        'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/long-haired.png',
        'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/hairless.png'
      ];
      
      imageUrls.forEach(url => {
        const img = new Image();
        img.onload = function() {
          console.log('Предзагружено изображение:', url);
          imageCache.set(url, img);
        };
        img.src = url;
      });
    }
    
    // Запускаем предзагрузку при загрузке страницы
    preloadImages();
    
    // Функция для обеспечения одинаковых размеров всех карточек
    function ensureEqualCardSizes() {
      const cards = document.querySelectorAll('.card');
      cards.forEach(card => {
        // Принудительно устанавливаем одинаковые размеры
        card.style.minWidth = '280px';
        card.style.width = '100%';
        card.style.flex = '1 1 280px';
        card.style.maxWidth = 'calc(50% - var(--gap-6)/2)';
      });
      console.log('Размеры всех карточек унифицированы');
    }
    
    // Глобальная функция для ручного вызова
    window.ensureEqualCardSizes = ensureEqualCardSizes;
    
    // Оптимизированная функция загрузки изображений
    function loadImageOptimized(src, alt, container, onLoad, onError) {
      // Проверяем кэш
      if (imageCache.has(src)) {
        const cachedImg = imageCache.get(src);
        container.innerHTML = '';
        container.appendChild(cachedImg.cloneNode());
        if (onLoad) onLoad();
        return;
      }
      
      // Создаем новое изображение
      const img = new Image();
      img.src = src;
      img.alt = alt;
      img.style.cssText = `
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 12px;
        display: block;
        background: transparent;
      `;
      
      // Обработка успешной загрузки
      img.onload = function() {
        // Кэшируем изображение
        imageCache.set(src, img.cloneNode());
        container.innerHTML = '';
        container.appendChild(img);
        if (onLoad) onLoad();
      };
      
      // Обработка ошибки
      img.onerror = function() {
        if (onError) onError();
      };
    }

    // Функция для принудительной установки изображения короткошерстных пород
    window.forceSetShorthairImageDirect = function() {
      console.log('Принудительно устанавливаем изображение короткошерстных пород...');
      
      const catsCatsElement = document.getElementById('cats-cats');
      if (!catsCatsElement) {
        console.error('Элемент cats-cats не найден');
        return;
      }
      
      const categoryCards = catsCatsElement.querySelectorAll('.card');
      categoryCards.forEach(card => {
        const title = card.querySelector('h3').textContent;
        if (title.includes('Короткошерстные')) {
          const imageContainer = card.querySelector('.ph');
          if (imageContainer) {
            console.log('Найдена карточка короткошерстных пород, устанавливаем изображение...');
            
            loadImageOptimized(
              'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/short-haired.png',
              'Короткошерстные породы',
              imageContainer,
              function() {
                console.log('Изображение short-haired.png успешно загружено');
                imageContainer.removeAttribute('aria-hidden');
              },
              function() {
                console.log('Ошибка загрузки изображения short-haired.png');
                imageContainer.innerHTML = '<div style="color: white; text-align: center; padding: 20px;">Ошибка загрузки</div>';
                imageContainer.setAttribute('aria-hidden', 'true');
              }
            );
            
            console.log('Изображение short-haired.png установлено для карточки короткошерстных пород');
          }
        }
      });
    };

    // Функция для принудительной установки изображения экзотических пород
    window.forceSetExoticImageDirect = function() {
      console.log('Принудительно устанавливаем изображение экзотических пород...');
      
      const catsCatsElement = document.getElementById('cats-cats');
      if (!catsCatsElement) {
        console.error('Элемент cats-cats не найден');
        return;
      }
      
      const categoryCards = catsCatsElement.querySelectorAll('.card');
      categoryCards.forEach(card => {
        const title = card.querySelector('h3').textContent;
        if (title.includes('Экзотические')) {
          const imageContainer = card.querySelector('.ph');
          if (imageContainer) {
            console.log('Найдена карточка экзотических пород, устанавливаем изображение...');
            
            loadImageOptimized(
              'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/exotic.png',
              'Экзотические и редкие породы',
              imageContainer,
              function() {
                console.log('Изображение exotic.png успешно загружено для экзотических пород');
                imageContainer.removeAttribute('aria-hidden');
              },
              function() {
                console.log('Ошибка загрузки изображения exotic.png для экзотических пород');
                imageContainer.innerHTML = '<div style="color: white; text-align: center; padding: 20px;">Ошибка загрузки</div>';
                imageContainer.setAttribute('aria-hidden', 'true');
              }
            );
            
            console.log('Изображение exotic.png установлено для карточки экзотических пород');
          }
        }
      });
    };

    // Функция для принудительной установки изображения бесшерстных пород
    window.forceSetHairlessImageDirect = function() {
      console.log('Принудительно устанавливаем изображение бесшерстных пород...');
      
      const catsCatsElement = document.getElementById('cats-cats');
      if (!catsCatsElement) {
        console.error('Элемент cats-cats не найден');
        return;
      }
      
      const categoryCards = catsCatsElement.querySelectorAll('.card');
      categoryCards.forEach(card => {
        const title = card.querySelector('h3').textContent;
        if (title.includes('Бесшерстные')) {
          const imageContainer = card.querySelector('.ph');
          if (imageContainer) {
            console.log('Найдена карточка бесшерстных пород, устанавливаем изображение...');
            
            loadImageOptimized(
              'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/hairless.png',
              'Бесшерстные породы',
              imageContainer,
              function() {
                console.log('Изображение hairless.png успешно загружено для бесшерстных пород');
                imageContainer.removeAttribute('aria-hidden');
              },
              function() {
                console.log('Ошибка загрузки изображения hairless.png для бесшерстных пород');
                imageContainer.innerHTML = '<div style="color: white; text-align: center; padding: 20px;">Ошибка загрузки</div>';
                imageContainer.setAttribute('aria-hidden', 'true');
              }
            );
            
            console.log('Изображение hairless.png установлено для карточки бесшерстных пород');
          }
        }
      });
    };

    // Функция для принудительной установки изображения длинношерстных пород
    window.forceSetLonghairImageDirect = function() {
      console.log('Принудительно устанавливаем изображение длинношерстных пород...');
      
      const catsCatsElement = document.getElementById('cats-cats');
      if (!catsCatsElement) {
        console.error('Элемент cats-cats не найден');
        return;
      }
      
      const categoryCards = catsCatsElement.querySelectorAll('.card');
      categoryCards.forEach(card => {
        const title = card.querySelector('h3').textContent;
        if (title.includes('Длинношерстные')) {
          const imageContainer = card.querySelector('.ph');
          if (imageContainer) {
            console.log('Найдена карточка длинношерстных пород, устанавливаем изображение...');
            
            loadImageOptimized(
              'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/long-haired.png',
              'Длинношерстные породы',
              imageContainer,
              function() {
                console.log('Изображение long-haired.png успешно загружено');
                imageContainer.removeAttribute('aria-hidden');
              },
              function() {
                console.log('Ошибка загрузки изображения long-haired.png');
                imageContainer.innerHTML = '<div style="color: white; text-align: center; padding: 20px;">Ошибка загрузки</div>';
              }
            );
            
            console.log('Изображение long-haired.png установлено для карточки длинношерстных пород');
          }
        }
      });
    };
    
    // Функция для установки черного фона для изображения длинношерстных пород
    window.setLonghairBlackBackground = function() {
      console.log('Устанавливаем черный фон для изображения длинношерстных пород...');
      
      const catsCatsElement = document.getElementById('cats-cats');
      if (!catsCatsElement) {
        console.error('Элемент cats-cats не найден');
        return;
      }
      
      const categoryCards = catsCatsElement.querySelectorAll('.card');
      categoryCards.forEach(card => {
        const title = card.querySelector('h3').textContent;
        if (title.includes('Длинношерстные')) {
          const imageContainer = card.querySelector('.ph');
          if (imageContainer) {
            imageContainer.classList.add('ph--black');
            // Принудительно устанавливаем темный фон через style
            imageContainer.style.backgroundColor = 'rgb(23, 26, 28)';
            console.log('Темный фон (rgb(23, 26, 28)) установлен для изображения длинношерстных пород');
          }
        }
      });
    };
    
    // Функция для принудительной установки изображения длинношерстных пород
    window.forceSetLonghairImage = function() {
      console.log('Принудительно устанавливаем изображение для длинношерстных пород...');
      
      const catsCatsElement = document.getElementById('cats-cats');
      if (!catsCatsElement) {
        console.error('Элемент cats-cats не найден');
        return;
      }
      
      const categoryCards = catsCatsElement.querySelectorAll('.card');
      categoryCards.forEach(card => {
        const title = card.querySelector('h3').textContent;
        if (title.includes('Длинношерстные')) {
          console.log('Найдена карточка длинношерстных пород, обновляем изображение и стили...');
          
          const imageContainer = card.querySelector('.ph');
          if (imageContainer) {
            // Добавляем класс с темным фоном к контейнеру изображения
            imageContainer.classList.add('ph--black');
            // Принудительно устанавливаем темный фон через style
            imageContainer.style.backgroundColor = 'rgb(23, 26, 28)';
            // Очищаем контейнер
            imageContainer.innerHTML = '';
            
            // Создаем изображение
            const img = document.createElement('img');
            img.src = 'https://zrntpatdzumhybclhrhp.supabase.co/storage/v1/object/public/cats/long-haired.png';
            img.alt = 'Длинношерстные породы';
            img.style.cssText = `
              width: 100%;
              height: 100%;
        object-fit: contain;
        border-radius: 12px;
        background: transparent;
        padding: 8px;
            `;
            
            // Обработка ошибки загрузки изображения
            img.onerror = function() {
              console.log('Ошибка загрузки изображения long-haired.png');
              imageContainer.textContent = "Фото";
              imageContainer.setAttribute('aria-hidden', 'true');
            };
            
            // Обработка успешной загрузки
            img.onload = function() {
              console.log('Изображение long-haired.png успешно загружено');
              imageContainer.removeAttribute('aria-hidden');
            };
            
            imageContainer.appendChild(img);
            console.log('Изображение long-haired.png и черный фон установлены для карточки длинношерстных пород');
          }
        }
      });
    };
    
    // Start the application when DOM is loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
  
  <!-- Подключение app.js для Supabase интеграции -->
  <script src="app.js"></script>
</body>
</html>